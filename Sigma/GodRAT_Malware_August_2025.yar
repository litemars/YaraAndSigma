rule GodRAT_Malware_August_2025 {
    meta:
        description = "Detection rule for GodRAT RAT targeting financial institutions"
        author = "litemars"
        date = "2025-08-21"
        version = "1.0"
        reference = "https://securelist.com/godrat/117119/"
        malware_family = "GodRAT"
        threat_actor = "Winnti/APT41"

    strings:
        // Unique strings found in GodRAT
        $magic1 = "godinfo" ascii
        $magic2 = "GETGOD" ascii
        $magic3 = "ONLINE.dll" ascii wide
        $xor_key1 = "OSEDBIU#IUSBDGKJS@SIHUDVNSO*SKJBKSDS#SFDBNXFCB" ascii
        $xor_key2 = "EG9RUOFIBVODSLFJBXLSVWKJENQWBIVUKDSZADVXBWEADSXZCXBVADZXVZXZXCBWES" ascii
        $command = "-Puppet" ascii
        $filename = "curl.exe" ascii
        $registry_key = "MyStartupApp" ascii
        $internal_name = "ONLINE.dll" ascii

        // File paths and directories
        $path1 = "%ALLUSERSPROFILE%\google\chrome.exe" ascii
        $path2 = "%ALLUSERSPROFILE%\google\msedge.exe" ascii
        $path3 = "%LOCALAPPDATA%\bugreport\LoggerCollector.dll" ascii
        $path4 = "%AppData%\config.ini" ascii

        // Network communication patterns
        $header_magic = { 74 78 20 }  // Magic bytes for C2 communication

        // Registry persistence
        $reg_persistence = "Software\Microsoft\Windows\CurrentVersion\Run" ascii

        // Executable names used for injection
        $exe1 = "svchost.exe" ascii
        $exe2 = "cmd.exe" ascii
        $exe3 = "cscript.exe" ascii
        $exe4 = "curl.exe" ascii
        $exe5 = "wscript.exe" ascii
        $exe6 = "QQMusic.exe" ascii
        $exe7 = "QQScLauncher.exe" ascii

    condition:
        uint16(0) == 0x5A4D and (
            (
                $magic1 and $magic2 and $magic3
            ) or
            (
                $xor_key1 or $xor_key2
            ) or
            (
                $command and any of ($exe*)
            ) or
            (
                $header_magic and 2 of ($path*)
            )
        ) and filesize < 10MB
}